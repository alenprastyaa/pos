import{j as K,r as x,c as J,y as O,o as Q,b as o,a as W,w as X,d as e,n as v,f as y,e as d,q as b,h as A,F as L,t as m,x as Y,p as w,v as E,z as V}from"./index-8z8FTn_k.js";import{a as _,S as p}from"./sweetalert2.esm.all-BgBW3QO9.js";import{_ as Z}from"./AdminLayout-_y-CTZnw.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const ee={class:"space-y-6"},te={class:"flex items-center justify-between"},ae=["disabled"],re={class:"overflow-hidden rounded-xl border border-gray-200 bg-white dark:border-gray-800 dark:bg-white/[0.03]"},se={class:"max-w-full overflow-x-auto custom-scrollbar"},oe={class:"min-w-full"},le={class:"divide-y divide-gray-200 dark:divide-gray-700"},de={key:0,class:"border-t border-gray-100 dark:border-gray-800"},ne={key:1,class:"border-t border-gray-100 dark:border-gray-800"},ie={class:"px-5 py-4 sm:px-6"},ue={class:"text-gray-800 text-theme-sm dark:text-white/90"},ge={class:"px-5 py-4 sm:px-6"},me={class:"text-gray-800 font-medium text-theme-sm dark:text-white/90"},xe={class:"px-5 py-4 sm:px-6"},pe={class:"text-gray-500 text-theme-sm dark:text-gray-400"},ce={class:"px-5 py-4 sm:px-6"},ye={class:"px-5 py-4 sm:px-6"},be={class:"text-gray-500 text-theme-sm dark:text-gray-400"},fe={class:"px-5 py-4 sm:px-6"},ke={class:"px-5 py-4 sm:px-6"},he={class:"text-gray-500 text-theme-sm dark:text-gray-400"},ve={class:"px-5 py-4 sm:px-6"},we={class:"flex gap-2"},_e=["disabled","onClick"],Ce=["disabled","onClick"],Me={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/30 backdrop-blur-sm"},Ue={class:"bg-white dark:bg-gray-900 rounded-lg shadow-lg w-full max-w-md p-6"},Be={class:"flex items-center justify-between mb-4"},Se={class:"text-xl font-semibold text-gray-900 dark:text-white"},De={class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},Te={key:0,class:"text-red-500"},$e={key:1,class:"text-gray-400"},Ee=["required"],Ae={key:0},Le=["value"],Ve={key:0,class:"text-xs text-gray-500 mt-1"},je={key:1},qe={class:"flex gap-3 pt-4"},Fe=["disabled"],Ge=K({__name:"DataUser",setup(Ne){const c="https://alentest.my.id/pos",j=x("superadmin"),n=J(()=>j.value==="superadmin"),U=x([]),f=x([]),B=x(!1),k=x(!1),C=x(!1),M=x(!1),g=x(!1),S={full_name:"",email:"",password:"",role_name:"",toko_id:null},s=x({...S}),h=()=>({Authorization:`Bearer ${localStorage.getItem("authToken")}`}),q=a=>new Date(a).toLocaleDateString("id-ID",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),F=a=>{switch(a.toLowerCase()){case"superadmin":return"inline-flex items-center rounded-md bg-purple-50 px-2 py-1 text-xs font-medium text-purple-700 ring-1 ring-inset ring-purple-700/10 dark:bg-purple-400/10 dark:text-purple-400 dark:ring-purple-400/30";case"admin":return"inline-flex items-center rounded-md bg-green-50 px-2 py-1 text-xs font-medium text-green-700 ring-1 ring-inset ring-green-600/20 dark:bg-green-400/10 dark:text-green-400 dark:ring-green-400/20";case"staff":return"inline-flex items-center rounded-md bg-yellow-50 px-2 py-1 text-xs font-medium text-yellow-800 ring-1 ring-inset ring-yellow-600/20 dark:bg-yellow-400/10 dark:text-yellow-400 dark:ring-yellow-400/20";default:return"inline-flex items-center rounded-md bg-gray-50 px-2 py-1 text-xs font-medium text-gray-600 ring-1 ring-inset ring-gray-500/10"}},N=a=>{switch(a.toLowerCase()){case"active":return"inline-flex items-center rounded-md bg-green-50 px-2 py-1 text-xs font-medium text-green-700 ring-1 ring-inset ring-green-600/20 dark:bg-green-400/10 dark:text-green-400 dark:ring-green-400/20";case"inactive":return"inline-flex items-center rounded-md bg-red-50 px-2 py-1 text-xs font-medium text-red-700 ring-1 ring-inset ring-red-600/10 dark:bg-red-400/10 dark:text-red-400 dark:ring-red-400/20";default:return"inline-flex items-center rounded-md bg-gray-50 px-2 py-1 text-xs font-medium text-gray-600 ring-1 ring-inset ring-gray-500/10"}},D=async()=>{k.value=!0;try{const a=await _.get(`${c}/toko`,{headers:h()});a.data.success&&(f.value=a.data.data)}catch(a){console.error("Fetch Toko error:",a)}finally{k.value=!1}},T=async()=>{var a,t;B.value=!0;try{const r=await _.get(`${c}/user`,{headers:h()});if(r.data.success){const l=r.data.data,i=new Map(f.value.map(u=>[u.id,u.nama_toko]));U.value=l.map(u=>({...u,toko_name:u.toko_id?i.get(u.toko_id):void 0}))}}catch(r){console.error("Fetch User error:",r),p.fire({icon:"error",title:"Error",text:((t=(a=r.response)==null?void 0:a.data)==null?void 0:t.message)||"Gagal mengambil data user"})}finally{B.value=!1}},R=async()=>{n.value&&(f.value.length===0&&!k.value&&await D(),g.value=!1,s.value={...S},M.value=!0)},H=async a=>{n.value&&(f.value.length===0&&!k.value&&await D(),g.value=!0,s.value={id:a.id,full_name:a.full_name,email:a.email,password:"",role_name:a.role_name,toko_id:a.toko_id||""},M.value=!0)},P=a=>{n.value&&p.fire({title:"Hapus User?",text:"Data user akan dihapus secara permanen",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Hapus",cancelButtonText:"Batal"}).then(t=>{t.isConfirmed&&z(a)})},z=async a=>{var t,r;try{const l=await _.delete(`${c}/user/${a}`,{headers:h()});l.data.success&&(await p.fire({icon:"success",title:"Berhasil",text:l.data.message||"User berhasil dihapus",timer:1500}),T())}catch(l){console.error("Delete error:",l),p.fire({icon:"error",title:"Error",text:((r=(t=l.response)==null?void 0:t.data)==null?void 0:r.message)||"Gagal menghapus user"})}},$=()=>{M.value=!1,s.value={...S},g.value=!1},G=()=>{const a=s.value;return!a.full_name||!a.email||!a.role_name?"Nama lengkap, email, dan role wajib diisi.":!g.value&&!a.password?"Password wajib diisi untuk registrasi user baru.":(a.role_name==="admin"||a.role_name==="staff")&&!a.toko_id?"Role Admin/Staff harus memilih Toko.":null},I=async()=>{var r,l;const a=G();if(a){p.fire({icon:"warning",title:"Validasi Gagal",text:a});return}C.value=!0;let t={full_name:s.value.full_name,email:s.value.email,role_name:s.value.role_name};s.value.password&&s.value.password.length>0&&(t.password=s.value.password),s.value.role_name!=="superadmin"&&(t.toko_id=s.value.toko_id);try{let i,u=`${c}/user`;g.value?(u=`${c}/user/${s.value.id}`,i=await _.put(u,t,{headers:h()})):(u=`${c}/user/auth/register`,i=await _.post(u,t,{headers:h()})),i.data.success&&(await p.fire({icon:"success",title:"Berhasil",text:i.data.message||"Data user berhasil disimpan",timer:1500}),$(),T())}catch(i){console.error("Submit error:",i),p.fire({icon:"error",title:`Error ${g.value?"Update":"Registrasi"}`,text:((l=(r=i.response)==null?void 0:r.data)==null?void 0:l.message)||"Gagal menyimpan data user"})}finally{C.value=!1}};return O(()=>s.value.role_name,a=>{a==="superadmin"?s.value.toko_id=null:(a==="admin"||a==="staff")&&s.value.toko_id===null&&(s.value.toko_id="")}),Q(async()=>{await D(),await T()}),(a,t)=>(o(),W(Z,null,{default:X(()=>[e("div",ee,[e("div",te,[t[6]||(t[6]=e("div",null,[e("h1",{class:"text-2xl font-semibold text-gray-900 dark:text-white"}," Data User "),e("p",{class:"text-gray-600 dark:text-gray-400"}," Kelola data pengguna sistem ")],-1)),e("button",{onClick:R,disabled:!n.value,class:v([{"opacity-50 cursor-not-allowed":!n.value},"flex items-center gap-2 px-4 py-2 text-white bg-blue-600 rounded-lg hover:bg-blue-700 transition"])},t[5]||(t[5]=[e("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[e("path",{d:"M10 4V16M4 10H16",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round"})],-1),y(" Tambah User ")]),10,ae)]),e("div",re,[e("div",se,[e("table",oe,[t[9]||(t[9]=e("thead",null,[e("tr",{class:"border-b border-gray-200 dark:border-gray-700"},[e("th",{class:"px-5 py-3 text-left sm:px-6"},[e("p",{class:"font-medium text-gray-500 text-theme-xs dark:text-gray-400"},"No")]),e("th",{class:"px-5 py-3 text-left sm:px-6"},[e("p",{class:"font-medium text-gray-500 text-theme-xs dark:text-gray-400"},"Nama Lengkap ")]),e("th",{class:"px-5 py-3 text-left sm:px-6"},[e("p",{class:"font-medium text-gray-500 text-theme-xs dark:text-gray-400"},"Email")]),e("th",{class:"px-5 py-3 text-left sm:px-6"},[e("p",{class:"font-medium text-gray-500 text-theme-xs dark:text-gray-400"},"Role")]),e("th",{class:"px-5 py-3 text-left sm:px-6"},[e("p",{class:"font-medium text-gray-500 text-theme-xs dark:text-gray-400"},"Toko")]),e("th",{class:"px-5 py-3 text-left sm:px-6"},[e("p",{class:"font-medium text-gray-500 text-theme-xs dark:text-gray-400"},"Status")]),e("th",{class:"px-5 py-3 text-left sm:px-6"},[e("p",{class:"font-medium text-gray-500 text-theme-xs dark:text-gray-400"},"Dibuat")]),e("th",{class:"px-5 py-3 text-left sm:px-6"},[e("p",{class:"font-medium text-gray-500 text-theme-xs dark:text-gray-400"},"Aksi")])])],-1)),e("tbody",le,[B.value?(o(),d("tr",de,t[7]||(t[7]=[e("td",{colspan:"8",class:"px-5 py-4 text-center sm:px-6"},[e("p",{class:"text-gray-500"},"Memuat data...")],-1)]))):U.value.length===0?(o(),d("tr",ne,t[8]||(t[8]=[e("td",{colspan:"8",class:"px-5 py-4 text-center sm:px-6"},[e("p",{class:"text-gray-500"},"Tidak ada data user")],-1)]))):b("",!0),(o(!0),d(L,null,A(U.value,(r,l)=>(o(),d("tr",{key:r.id,class:"border-t border-gray-100 dark:border-gray-800"},[e("td",ie,[e("p",ue,m(l+1),1)]),e("td",ge,[e("p",me,m(r.full_name),1)]),e("td",xe,[e("p",pe,m(r.email),1)]),e("td",ce,[e("span",{class:v(F(r.role_name))},m(r.role_name),3)]),e("td",ye,[e("p",be,m(r.toko_name||"-"),1)]),e("td",fe,[e("span",{class:v(N(r.status))},m(r.status),3)]),e("td",ke,[e("p",he,m(q(r.created_at)),1)]),e("td",ve,[e("div",we,[e("button",{disabled:!n.value,class:v([n.value?"text-blue-600 bg-blue-50 hover:bg-blue-100 dark:bg-blue-500/15 dark:text-blue-400":"text-gray-400 bg-gray-100 opacity-50 cursor-not-allowed","px-3 py-1 rounded-lg transition"]),onClick:i=>n.value?H(r):null}," Edit ",10,_e),e("button",{disabled:!n.value,class:v([n.value?"text-red-600 bg-red-50 hover:bg-red-100 dark:bg-red-500/15 dark:text-red-400":"text-gray-400 bg-gray-100 opacity-50 cursor-not-allowed","px-3 py-1 rounded-lg transition"]),onClick:i=>n.value?P(r.id):null}," Hapus ",10,Ce)])])]))),128))])])])]),M.value?(o(),d("div",Me,[e("div",Ue,[e("div",Be,[e("h2",Se,m(g.value?"Edit User":"Tambah User Baru"),1),e("button",{onClick:$,class:"text-gray-500 hover:text-gray-700 dark:hover:text-gray-300"},t[10]||(t[10]=[e("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[e("path",{d:"M18 6L6 18M6 6l12 12",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round"})],-1)]))]),e("form",{onSubmit:Y(I,["prevent"]),class:"space-y-4"},[e("div",null,[t[11]||(t[11]=e("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[y(" Nama Lengkap"),e("span",{class:"text-red-500"},"*")],-1)),w(e("input",{"onUpdate:modelValue":t[0]||(t[0]=r=>s.value.full_name=r),type:"text",placeholder:"Masukkan nama lengkap",required:"",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[E,s.value.full_name]])]),e("div",null,[t[12]||(t[12]=e("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[y(" Email"),e("span",{class:"text-red-500"},"*")],-1)),w(e("input",{"onUpdate:modelValue":t[1]||(t[1]=r=>s.value.email=r),type:"email",placeholder:"Masukkan email",required:"",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[E,s.value.email]])]),e("div",null,[e("label",De,[t[13]||(t[13]=y(" Password")),g.value?b("",!0):(o(),d("span",Te,"*")),g.value?(o(),d("span",$e,"(Kosongkan jika tidak diubah)")):b("",!0)]),w(e("input",{"onUpdate:modelValue":t[2]||(t[2]=r=>s.value.password=r),type:"password",placeholder:"Masukkan password",required:!g.value,class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,8,Ee),[[E,s.value.password]])]),e("div",null,[t[15]||(t[15]=e("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[y(" Role"),e("span",{class:"text-red-500"},"*")],-1)),w(e("select",{"onUpdate:modelValue":t[3]||(t[3]=r=>s.value.role_name=r),required:"",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},t[14]||(t[14]=[e("option",{value:"",disabled:""},"Pilih Role",-1),e("option",{value:"superadmin"},"Super Admin",-1),e("option",{value:"admin"},"Admin",-1),e("option",{value:"staff"},"Staff",-1)]),512),[[V,s.value.role_name]])]),s.value.role_name==="admin"||s.value.role_name==="staff"?(o(),d("div",Ae,[t[17]||(t[17]=e("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[y(" Toko"),e("span",{class:"text-red-500"},"*")],-1)),w(e("select",{"onUpdate:modelValue":t[4]||(t[4]=r=>s.value.toko_id=r),required:"",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},[t[16]||(t[16]=e("option",{value:"",disabled:""},"Pilih Toko",-1)),(o(!0),d(L,null,A(f.value,r=>(o(),d("option",{key:r.id,value:r.id},m(r.nama_toko),9,Le))),128))],512),[[V,s.value.toko_id]]),k.value?(o(),d("p",Ve,"Memuat data toko...")):b("",!0)])):s.value.role_name==="superadmin"?(o(),d("div",je,t[18]||(t[18]=[e("p",{class:"text-sm text-gray-500 dark:text-gray-400"}," *User **Super Admin** tidak memerlukan **Toko ID**. ",-1)]))):b("",!0),e("div",qe,[e("button",{type:"button",onClick:$,class:"flex-1 px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 dark:bg-gray-800 dark:text-gray-300 dark:hover:bg-gray-700 transition"}," Batal "),e("button",{type:"submit",disabled:C.value,class:"flex-1 px-4 py-2 text-white bg-blue-600 rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition"},m(C.value?"Menyimpan...":"Simpan"),9,Fe)])],32)])])):b("",!0)])]),_:1}))}});export{Ge as default};
